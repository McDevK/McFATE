<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>McFATE - F.A.T.E.计时器</title>
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="light">
  <main class="fate-container" id="fateContainer">
    <header class="fate-header">
      <div class="fate-title">
        <!-- <a href="../" class="home-link" title="返回主页">
          <img src="./assets/icons/button/back.png" alt="返回" class="back-icon">
        </a> -->
        <img src="./assets/icons/button/FATE.png" alt="FATE" class="fate-logo"><span>F.A.T.E.计时器</span>
      </div>
              <div class="fate-actions">
          <!-- 时间显示 -->
          <div class="local-time-box" title="Eorzea / Local Time">
            <div class="time-row et">
              <span class="time-label">艾</span>
              <span class="time-value" id="eorzeaTimeValue">00:00</span>
            </div>
            <div class="time-row lt">
              <span class="time-label">本</span>
              <span class="time-value" id="localTimeValue">00:00</span>
            </div>
          </div>
        <button class="fate-btn fate-list-toggle" id="listToggle" title="列表视图" aria-label="列表视图">
          <img src="./assets/icons/button/list.png" alt="列表" class="list-icon">
        </button>
        <button class="fate-btn fate-theme-toggle" id="themeToggle" title="白天/夜晚" aria-label="白天/夜晚">
          <img src="./assets/icons/button/light.png" alt="白天" class="theme-icon">
        </button>
      </div>
    </header>
    <section class="fate-body" id="fateBody">
      
      


      <!-- 当前艾欧泽亚时间和天气显示 -->
      <div class="current-status" id="currentStatus">
        <div class="status-time">
          <span class="status-label">艾欧泽亚时间：</span>
          <span class="status-value" id="eorzeaTime">--:--</span>
        </div>
        <div class="status-weather">
          <span class="status-label">当前天气变化：</span>
          <span class="status-value" id="weatherCountdown">计算中...</span>
        </div>
      </div>

      <!-- FATE列表 -->
      <div class="fate-list-header">
        <div class="search-box">
          <input type="text" id="fateSearch" placeholder="搜索地图/FATE名称/目标...">
          <i class="fas fa-search search-icon"></i>
          <button class="clear-btn" id="clearSearch" title="清除搜索" style="display: none;">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="hide-btn" id="hideCompletedBtn" title="隐藏已完成" aria-label="隐藏已完成">
          <img src="./assets/icons/button/hide.png" alt="隐藏" class="hide-icon">
        </button>
        <div class="filter-container">
          <button class="filter-btn" id="filterBtn" title="筛选">
            <img src="./assets/icons/button/filter.webp" alt="筛选" onerror="this.style.display='none'" />
          </button>
          <!-- 漂浮筛选框 -->
          <div id="filterDropdown" class="filter-dropdown hidden">
            <div class="filter-dropdown-content">
              <div class="filter-group">
                <div class="filter-title">地图区域</div>
                <div class="filter-sections">
                  <!-- 萨纳兰地区 -->
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="萨纳兰">
                        <i class="fas fa-chevron-down"></i>
                        <span>萨纳兰地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="萨纳兰" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-萨纳兰">
                      <button class="chip active" data-key="map" data-value="西萨纳兰">西萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="中萨纳兰">中萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="东萨纳兰">东萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="南萨纳兰">南萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="北萨纳兰">北萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="乌尔达哈">乌尔达哈</button>
                    </div>
                  </div>
                  
                  <!-- 黑衣森林地区 -->
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="黑衣森林">
                        <i class="fas fa-chevron-down"></i>
                        <span>黑衣森林地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="黑衣森林" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-黑衣森林">
                      <button class="chip active" data-key="map" data-value="黑衣森林中部林区">黑衣森林中部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林东部林区">黑衣森林东部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林南部林区">黑衣森林南部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林北部林区">黑衣森林北部林区</button>
                      <button class="chip active" data-key="map" data-value="格里达尼亚">格里达尼亚</button>
                    </div>
                  </div>
                  
                  <!-- 拉诺西亚地区 -->
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="拉诺西亚">
                        <i class="fas fa-chevron-down"></i>
                        <span>拉诺西亚地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="拉诺西亚" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-拉诺西亚">
                      <button class="chip active" data-key="map" data-value="中拉诺西亚">中拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚低地">拉诺西亚低地</button>
                      <button class="chip active" data-key="map" data-value="东拉诺西亚">东拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="西拉诺西亚">西拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚高地">拉诺西亚高地</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚外地">拉诺西亚外地</button>
                      <button class="chip active" data-key="map" data-value="利姆萨·罗敏萨">利姆萨·罗敏萨</button>
                    </div>
                  </div>
                  
                  <!-- 伊修加德地区 -->
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="伊修加德">
                        <i class="fas fa-chevron-down"></i>
                        <span>伊修加德地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="伊修加德" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-伊修加德">
                      <button class="chip active" data-key="map" data-value="库尔札斯中央高地">库尔札斯中央高地</button>
                    </div>
                  </div>
                  
                  <!-- 其他地区 -->
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="其他">
                        <i class="fas fa-chevron-down"></i>
                        <span>其他地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="其他" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-其他">
                      <button class="chip active" data-key="map" data-value="摩杜纳">摩杜纳</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <div class="filter-title">完成状态</div>
                <div class="chips" id="filterCompletion">
                  <button class="chip active" data-key="completion" data-value="未完成">未完成</button>
                  <button class="chip active" data-key="completion" data-value="已完成">已完成</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="fate-list" id="fateList">
        <div class="loading-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>正在加载FATE数据...</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 版权信息 -->
  <footer class="footer">
      <div class="footer-divider"></div>
      <div class="footer-content">
                      <div class="footer-info">
                <p>&copy; 2025 McTools | 麦满分🌸黄金谷  麦当劳🌸黄金谷</p>
                <p>基于 ｜ <span class="authors">苏烟Suyn<br>桑尼米尔克🌸日影地修炼所<br>初舞🌸天幕魔导城<br>静希肥肥十郎🌸天幕魔导城</span> ｜ 统计数据</p>
                <p>备案号：<a href="https://www.baidu.com" target="_blank">123789126891274987129</a><br></p>
            </div>
          <div class="footer-links">
              <span></span>
              <span></span>
              <span></span>
          </div>
      </div>
  </footer>
  <script src="script.js"></script>
  <script>
    // Service Worker 注册
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('../sw.js')
          .then(function(registration) {
            console.log('SW registered: ', registration);
            
            // 监听更新
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('New version available');
                    // 自动跳过等待并刷新页面
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                });
              }
            });
          })
          .catch(function(registrationError) {
            console.log('SW registration failed: ', registrationError);
          });
        
        // 监听Service Worker控制器变化
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('New Service Worker activated');
          window.location.reload();
        });
      });
    }
  </script>
</body>
</html>
