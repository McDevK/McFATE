<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>McFATE - F.A.T.E.计时器</title>
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="light">
  <main class="fate-container" id="fateContainer">
    <header class="fate-header">
      <div class="fate-title">
        <img src="./assets/icons/button/FATE.png" alt="FATE" class="fate-logo"><span>F.A.T.E.计时器</span>
      </div>
      <div class="fate-actions">
        <div class="local-time-box" title="Eorzea / Local Time">
          <div class="time-row et">
            <span class="time-label">艾</span>
            <span class="time-value" id="eorzeaTimeValue">00:00</span>
          </div>
          <div class="time-row lt">
            <span class="time-label">本</span>
            <span class="time-value" id="localTimeValue">00:00</span>
          </div>
        </div>
        <button class="fate-btn fate-list-toggle" id="listToggle" title="列表视图" aria-label="列表视图">
          <img src="./assets/icons/button/list.png" alt="列表" class="list-icon">
        </button>
        <button class="fate-btn fate-theme-toggle" id="themeToggle" title="白天/夜晚" aria-label="白天/夜晚">
          <img src="./assets/icons/button/light.png" alt="白天" class="theme-icon">
        </button>
        <button class="fate-btn fate-settings-toggle" id="settingsToggle" title="设置" aria-label="设置">
          <img src="./assets/icons/button/setting.png" alt="设置" class="setting-icon">
        </button>
        <input id="importDataInput" type="file" accept="application/json" hidden />
      </div>
    </header>
    <section class="fate-body" id="fateBody">
      <div class="card-container" onclick="flipCard()">
        <div class="flip-card" id="flipCard">
          <div class="card-front">
            <div class="title-decoration"></div>
            <div class="emergency-title">— 艾欧泽亚F.A.T.E处理许可证 —</div>
          </div>
          <div class="card-back">
            <div class="info-content">
              <div class="avatar-section">
                <div class="avatar" id="avatarContainer" aria-label="角色头像">
                  <img id="avatarImage" src="" alt="角色头像" style="display: none;">
                  <div class="avatar-placeholder">
                    <i class="fas fa-user"></i>
                  </div>
                </div>
                <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
              </div>
              <div class="info-section">
                <div class="main-info">
                  <div class="info-item">
                    <div class="info-label">持证人</div>
                    <input type="text" class="info-input" id="cardHolderName" value="麦当劳" placeholder="请输入角色名" maxlength="10">
                  </div>
                  <div class="info-item">
                    <div class="info-label">服务器</div>
                    <input type="text" class="info-input" id="cardServerName" value="黄金谷" placeholder="请输入服务器" maxlength="10">
                  </div>
                  <div class="info-item">
                    <div class="info-label">称号</div>
                    <div class="info-value" id="cardTitle">无</div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">已完成目标</div>
                    <div class="info-value" id="cardCompletionCount">0个</div>
                  </div>
                </div>
                <div class="certificate-info">
                  - 艾欧泽亚紧急事件处理协会制证 -
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="current-status" id="currentStatus">
        <button class="status-time-btn" id="timeDisplayBtn" title="艾欧泽亚时间">
          <span class="status-label">艾欧泽亚时间：</span>
          <span class="status-value" id="eorzeaTime">--:--</span>
        </button>
        <button class="status-weather-btn" id="weatherDisplayBtn" title="当前天气变化">
          <span class="status-label">当前天气变化：</span>
          <span class="status-value" id="weatherCountdown">计算中...</span>
        </button>
        <button class="status-completion-btn" id="completionToggleBtn" title="点击切换统计方式">
          <span class="status-label" id="completionLabel">已完成目标：</span>
          <span class="status-value" id="completionCount">0/0</span>
        </button>
        <button class="status-filter-completion-btn" id="filterCompletionToggleBtn" title="点击切换统计方式">
          <span class="status-label" id="filterCompletionLabel">筛选区域完成度：</span>
          <span class="status-value" id="filterCompletionCount">0/0</span>
        </button>
      </div>

      <div class="fate-list-header">
        <div class="search-box">
          <input type="text" id="fateSearch" placeholder="搜索地图/FATE名称/目标...">
          <i class="fas fa-search search-icon"></i>
          <button class="clear-btn" id="clearSearch" title="清除搜索" style="display: none;">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="hide-btn" id="hideCompletedBtn" title="隐藏已完成" aria-label="隐藏已完成">
          <img src="./assets/icons/button/hide.png" alt="隐藏" class="hide-icon">
        </button>
        <div class="filter-container">
          <button class="filter-btn" id="filterBtn" title="筛选">
            <img src="./assets/icons/button/filter.webp" alt="筛选" onerror="this.style.display='none'" />
          </button>
          <div id="filterDropdown" class="filter-dropdown hidden">
            <div class="filter-dropdown-content">
              <div class="filter-group">
                <div class="filter-title">地图区域</div>
                <div class="filter-sections">
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="萨纳兰">
                        <i class="fas fa-chevron-down"></i>
                        <span>萨纳兰地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="萨纳兰" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-萨纳兰">
                      <button class="chip active" data-key="map" data-value="西萨纳兰">西萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="中萨纳兰">中萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="东萨纳兰">东萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="南萨纳兰">南萨纳兰</button>
                      <button class="chip active" data-key="map" data-value="北萨纳兰">北萨纳兰</button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="黑衣森林">
                        <i class="fas fa-chevron-down"></i>
                        <span>黑衣森林地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="黑衣森林" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-黑衣森林">
                      <button class="chip active" data-key="map" data-value="黑衣森林中部林区">黑衣森林中部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林东部林区">黑衣森林东部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林南部林区">黑衣森林南部林区</button>
                      <button class="chip active" data-key="map" data-value="黑衣森林北部林区">黑衣森林北部林区</button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="拉诺西亚">
                        <i class="fas fa-chevron-down"></i>
                        <span>拉诺西亚地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="拉诺西亚" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-拉诺西亚">
                      <button class="chip active" data-key="map" data-value="中拉诺西亚">中拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚低地">拉诺西亚低地</button>
                      <button class="chip active" data-key="map" data-value="东拉诺西亚">东拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="西拉诺西亚">西拉诺西亚</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚高地">拉诺西亚高地</button>
                      <button class="chip active" data-key="map" data-value="拉诺西亚外地">拉诺西亚外地</button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="伊修加德">
                        <i class="fas fa-chevron-down"></i>
                        <span>伊修加德地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="伊修加德" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-伊修加德">
                      <button class="chip active" data-key="map" data-value="库尔札斯中央高地">库尔札斯中央高地</button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="section-header">
                      <button class="section-toggle active" data-section="其他">
                        <i class="fas fa-chevron-down"></i>
                        <span>其他地区</span>
                      </button>
                      <button class="section-toggle-all" data-section="其他" title="全选/取消全选">
                        <i class="fas fa-check-double"></i>
                      </button>
                    </div>
                    <div class="section-content" id="section-其他">
                      <button class="chip active" data-key="map" data-value="摩杜纳">摩杜纳</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <div class="filter-title">完成状态</div>
                <div class="chips" id="filterCompletion">
                  <button class="chip active" data-key="completion" data-value="未完成">未完成</button>
                  <button class="chip active" data-key="completion" data-value="已完成">已完成</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="quick-filter-buttons list-view-only">
        <button class="quick-filter-btn" id="timeLimitBtn" title="限时">
          <span class="btn-text">限时</span>
        </button>
        <button class="quick-filter-btn" id="runeBtn" title="符文">
          <span class="btn-text">符文</span>
        </button>
        <button class="quick-filter-btn" id="luckyBtn" title="幸运">
          <span class="btn-text">幸运</span>
        </button>
        <button class="quick-filter-btn" id="highRiskBtn" title="高危">
          <span class="btn-text">高危</span>
        </button>
        <button class="quick-filter-btn" id="weatherBtn" title="天气">
          <span class="btn-text">天气</span>
        </button>
        <button class="quick-filter-btn" id="timeBtn" title="时间">
          <span class="btn-text">时间</span>
        </button>
      </div>
      
      <div class="fate-list" id="fateList">
        <div class="loading-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>正在加载FATE数据...</p>
        </div>
      </div>
    </section>
  </main>

  <div id="avatarModal" class="avatar-modal hidden">
    <div class="avatar-modal-content">
      <div class="avatar-modal-header">
        <h3>调整头像</h3>
        <button class="avatar-modal-close" id="avatarModalClose">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="avatar-modal-body">
        <div class="avatar-crop-container">
          <div class="avatar-crop-area">
            <img id="avatarCropImage" src="" alt="调整头像">
            <div class="avatar-crop-overlay">
              <div class="avatar-crop-frame"></div>
            </div>
          </div>
        </div>
        <div class="avatar-controls">
          <div class="avatar-control-group">
            <label>缩放:</label>
            <input type="range" id="avatarScale" min="0.01" max="2" step="0.01" value="1">
            <span id="avatarScaleValue">100%</span>
          </div>
        </div>
      </div>
      <div class="avatar-modal-footer">
        <button class="avatar-btn avatar-btn-cancel" id="avatarCancelBtn">取消</button>
        <button class="avatar-btn avatar-btn-confirm" id="avatarConfirmBtn">确认</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-divider"></div>
    <div class="footer-content">
      <div class="footer-info">
        <p>&copy; 2025 McTools | 麦满分🌸黄金谷  麦当劳🌸黄金谷</p>
        <p class="authors-line">
          <span class="based-text">基于 ｜</span>
          <span class="authors-list">
            <span class="author-item">苏烟Suyn</span>
            <span class="author-item">桑尼米尔克🌸日影地修炼所</span>
            <span class="author-item">初舞🌸天幕魔导城</span>
            <span class="author-item">静希肥肥十郎🌸天幕魔导城</span>
          </span>
          <span class="stats-text">｜ 统计数据</span>
        </p>
      </div>
      <div class="footer-links">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </footer>
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js')
          .then(function(registration) {
            console.log('SW registered: ', registration);
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('New version available');
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                });
              }
            });
          })
          .catch(function(registrationError) {
            console.log('SW registration failed: ', registrationError);
          });
        
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('New Service Worker activated');
          window.location.reload();
        });
      });
    }
  </script>
</body>
</html>
